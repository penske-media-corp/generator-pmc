image:
  name: penskemediacorporation/pipeline-compose
  username: $DOCKERHUB_PIPELINE_USERNAME
  password: $DOCKERHUB_PIPELINE_PASSWORD
options:
  docker: true

pipelines:
  default:
    - step:
        name: Build
        artifacts:
          - languages/**
        services:
          - docker
        caches:
          - composer
          - composerlocal
          - docker
          - node
        script:
          - . /usr/local/bin/docker-entrypoint.sh && build
    - step:
        name: Test
        caches:
          - composer
          - composerlocal
          - docker
          - node
        services:
          - docker
        script:
          - . /usr/local/bin/docker-entrypoint.sh && test
<% if (wpHasSvnDeploy) { %>
    - step:
        name: Deploy to VIP SVN
        deployment: production
        trigger: manual
        image:
          name: penskemediacorporation/pipeline-deploy
          username: $DOCKERHUB_PIPELINE_USERNAME
          password: $DOCKERHUB_PIPELINE_PASSWORD
        script:
          - source /usr/local/bin/start.sh<% } %>

definitions:
  caches:
    composerlocal: vendor
